# Workflow 文档更新总结

> 更新日期: 2025-12-16
> 触发原因: SCL-90 开发中发现雷达图显示错误
> 影响范围: 所有有维度展示的量表

---

## 📌 更新内容概览

### 1. 新增"步骤 5.1: 雷达图数据处理"专节 ⭐ 重要

**位置**: 步骤 5 中新增子章节
**内容**:
- 明确雷达图 `fullMark` 必须与量表评分制匹配的原则
- 提供 4 种常见评分制的处理方式表格
- 提供 3 种处理方式的代码模板
- 添加"如何选择处理方式"的决策指南
- 提供调试技巧

**为什么重要**:
这是本次 SCL-90 问题的核心所在。之前的 workflow 默认开发者会"自然而然"地处理雷达图数据，但实际上不同评分制需要完全不同的处理方式。

---

### 2. 强化"步骤 6: 测试"的雷达图检查

**修改内容**:
```markdown
- [ ] 维度雷达图正确 (如适用) ⚠️ 重点检查:
  - [ ] 所有维度数值在合理范围内（不应全是 0 或全是 100）
  - [ ] fullMark 与量表评分制匹配
  - [ ] 雷达图形状能反映真实的维度差异
  - [ ] ShareCard 和结果详情页的雷达图数据一致
  - [ ] 打开浏览器控制台，检查是否有雷达图相关错误
```

**改进点**:
- 从笼统的"正确"变为具体的 5 项检查标准
- 特别强调数值合理性检查（避免全 0 或全 100 的情况）
- 添加一致性检查（ShareCard 和结果页）

---

### 3. 新增"常见陷阱 8: 雷达图数据格式错误"

**内容**:
- ❌ 错误示例：1-5 分制量表使用 fullMark=100
- ✅ 正确示例：fullMark=5
- 解释视觉影响：1.47/100 ≈ 1.5% vs 1.47/5 ≈ 29%
- 提供 4 条避免方法

**价值**:
用真实的错误案例（SCL-90）教育未来的开发者，避免重复犯错。

---

### 4. 扩展"测评类型快速参考表"

**新增列**:
- **评分制** (1-5 分制, 0-100, 0-1 归一化等)
- **雷达图 fullMark** (5, 100 等)

**新增行**:
- SCL-90 (1-5 分制因子分, fullMark=5)

**关键提醒**:
> ⚠️ 关键提醒: "评分制"和"雷达图 fullMark"列必须匹配！开发前务必明确。

---

## 🎯 问题分析：为什么之前的 Workflow 没有捕获这个问题？

### ❌ 之前的覆盖情况

| 方面 | 旧版本 | 问题 |
|-----|-------|-----|
| 雷达图处理 | 一句话带过："维度雷达图 (如有)" | 太笼统，没有说明不同评分制的区别 |
| 测试标准 | "维度雷达图正确 (如适用)" | 缺少具体的验证标准 |
| 量表分类 | 按计分方式（简单/复杂） | 没有按评分制分类 |
| 示例代码 | 无 | 开发者不知道如何处理 |

### ✅ 现在的覆盖情况

| 方面 | 新版本 | 改进 |
|-----|-------|-----|
| 雷达图处理 | **专门章节 5.1** | 详细的表格、代码模板、决策指南 |
| 测试标准 | **5 项具体检查** | 可操作的验证清单 |
| 量表分类 | **增加评分制和 fullMark 列** | 一目了然的对照表 |
| 示例代码 | **3 种处理方式的完整代码** | 复制粘贴即可使用 |

---

## 📊 影响范围分析

### 受影响的量表类型

| 评分制 | 现有量表 | 是否需要检查 |
|-------|---------|------------|
| 1-5 分制 | SCL-90, ESS, INI, BES | ✅ 是（SCL-90已修复） |
| 0-100 百分比 | EQ, PAT, Workhorse, ANI | ⚠️ 建议复查 |
| 0-1 归一化 | ZHZ, Zootopia | ⚠️ 建议复查 |

### 检查建议

**立即行动**:
1. 测试所有现有量表的雷达图显示
2. 验证数值范围是否合理
3. 对照新版 workflow 检查处理方式

**未来开发**:
1. 严格按照步骤 5.1 的指导实现
2. 测试时使用步骤 6 的 5 项检查清单
3. 参考快速参考表选择正确的 fullMark

---

## 🔧 具体修复示例（SCL-90）

### 问题表现
- 用户反馈：雷达图所有维度都是 0
- 实际数据：总分 132, GSI 1.47, 因子分约 1.2-1.6
- 根本原因：fullMark=100，导致 1.47/100 ≈ 1.5%，视觉上接近 0

### 修复代码
```typescript
// result/[resultId]/page.tsx:276-282
} else if (isSCL90 && result.dimensionScores) {
  radarData = scale.dimensions?.map((dimension) => ({
    dimension: dimension.name,
    value: Math.round((result.dimensionScores![dimension.id] || 0) * 100) / 100,
    fullMark: 5,  // ← 关键修复
  }));
}
```

### 验证结果
- ✅ 雷达图正常显示
- ✅ 数值范围合理（1-5）
- ✅ 能反映维度差异

---

## 📝 关键教训

### 1. 评分制是核心属性
不同评分制 = 不同数据处理方式，必须在开发初期明确。

### 2. "正确"不等于"正确"
测试不能只看"有没有雷达图"，还要看"雷达图是否合理"。

### 3. 分类要多维度
按计分方式分类 + 按评分制分类 = 更全面的指导。

### 4. 示例代码很重要
没有代码模板，开发者容易凭感觉猜测，导致错误。

### 5. Workflow 要具体
"如适用" < "5 项具体检查标准"

---

## ✅ 更新前后对比

| 指标 | 更新前 | 更新后 | 改进幅度 |
|-----|-------|-------|---------|
| 雷达图处理指导 | 1 句话 | 1 整节（~50 行） | 🔴 → 🟢 |
| 测试检查项 | 1 项 | 5 项 | 🟡 → 🟢 |
| 代码示例 | 0 个 | 3 个 | 🔴 → 🟢 |
| 快速参考列数 | 5 列 | 7 列（+评分制+fullMark） | 🟡 → 🟢 |
| 常见陷阱数 | 7 个 | 8 个（+雷达图错误） | 🟡 → 🟢 |

---

## 🚀 后续行动

### 短期（本周）
- [x] 修复 SCL-90 雷达图问题
- [x] 更新 workflow 文档
- [ ] 测试所有现有量表的雷达图
- [ ] 如有问题，按新 workflow 修复

### 中期（本月）
- [ ] 考虑在量表定义中增加 `scoreScale` 字段
- [ ] 编写雷达图数据生成的通用工具函数
- [ ] 优化 result 页面的雷达图逻辑

### 长期（未来）
- [ ] 建立量表开发的自动化测试
- [ ] 定期审查和更新 workflow
- [ ] 收集更多边缘案例

---

## 📚 相关文档

- [问题分析详细报告](workflow-scl90-issue-analysis.md)
- [更新后的 Workflow](assessment-development-workflow.md)
- [SCL-90 模板](assessments/scl90-filled-template.md)

---

**维护者**: Claude (AI Assistant)
**最后更新**: 2025-12-16
**下次审查**: 2025-12-23（一周后）

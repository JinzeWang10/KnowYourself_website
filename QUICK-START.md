# ğŸš€ æœåŠ¡å™¨é‡è£…å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“ é‡è£…æ­¥éª¤æ¦‚è§ˆ

```
å‡†å¤‡é˜¶æ®µ â†’ å¤‡ä»½æ•°æ® â†’ é‡è£…ç³»ç»Ÿ â†’ æ¢å¤éƒ¨ç½² â†’ å®‰å…¨åŠ å›º â†’ éªŒè¯æµ‹è¯•
```

**é¢„è®¡æ€»æ—¶é—´**: 2-4 å°æ—¶

---

## âš¡ å¿«é€Ÿæ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå¤‡ä»½ï¼ˆæ—§æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰

```bash
# 1. ç™»å½•æ—§æœåŠ¡å™¨
ssh root@your-old-server-ip

# 2. ä¸Šä¼ å¹¶è¿è¡Œå¤‡ä»½è„šæœ¬
# ï¼ˆå…ˆä»æœ¬åœ°ä¸Šä¼  backup-before-reinstall.shï¼‰
chmod +x backup-before-reinstall.sh
./backup-before-reinstall.sh

# 3. ä¸‹è½½å¤‡ä»½åˆ°æœ¬åœ°ï¼ˆåœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼‰
scp root@your-old-server-ip:~/backup_*.tar.gz ./server_backup/

# 4. éªŒè¯å¤‡ä»½
tar -tzf ./server_backup/backup_*.tar.gz | head -20
```

### ç¬¬äºŒæ­¥ï¼šè®°å½•é‡è¦ä¿¡æ¯

```
[ ] æœåŠ¡å™¨IP: _______________
[ ] åŸŸå: _______________
[ ] æ•°æ®åº“å¯†ç : _______________
[ ] Gitä»“åº“åœ°å€: _______________
[ ] SSLè¯ä¹¦é‚®ç®±: _______________
```

### ç¬¬ä¸‰æ­¥ï¼šé‡è£…ç³»ç»Ÿ

1. ç™»å½•äº‘æœåŠ¡å•†æ§åˆ¶å°
2. é€‰æ‹©"é‡è£…ç³»ç»Ÿ"æˆ–"æ›´æ¢ç³»ç»Ÿç›˜"
3. é€‰æ‹© **Ubuntu 22.04 LTS**
4. è®¾ç½®æ–°çš„ root å¯†ç 
5. ç¡®è®¤å¹¶ç­‰å¾…é‡è£…å®Œæˆï¼ˆ5-10åˆ†é’Ÿï¼‰

### ç¬¬å››æ­¥ï¼šå¿«é€Ÿéƒ¨ç½²ï¼ˆæ–°æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰

```bash
# 1. ç™»å½•æ–°æœåŠ¡å™¨
ssh root@your-new-server-ip

# 2. ä¸Šä¼ å¹¶è¿è¡Œéƒ¨ç½²è„šæœ¬
# ï¼ˆå…ˆä»æœ¬åœ°ä¸Šä¼  fresh-deploy.shï¼‰
chmod +x fresh-deploy.sh
./fresh-deploy.sh

# è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
# âœ“ å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆNode.js, PostgreSQL, Nginxï¼‰
# âœ“ é…ç½®æ•°æ®åº“
# âœ“ éƒ¨ç½²åº”ç”¨
# âœ“ å®‰è£… SSL è¯ä¹¦
# âœ“ é…ç½®é˜²ç«å¢™

# 3. ä¸Šä¼ å¤‡ä»½æ–‡ä»¶å¹¶æ¢å¤æ•°æ®åº“
scp ./server_backup/backup_*.tar.gz root@your-new-server:~/
ssh root@your-new-server
tar -xzf backup_*.tar.gz
cd backup_*/
pg_restore -U scales_user -d scales_db -v database_backup_*.dump
```

### ç¬¬äº”æ­¥ï¼šéªŒè¯

```bash
# æ£€æŸ¥åº”ç”¨çŠ¶æ€
pm2 status

# è®¿é—®ç½‘ç«™
curl https://your-domain.com

# æŸ¥çœ‹æ—¥å¿—
pm2 logs knowyourself
```

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| [SERVER-MIGRATION.md](SERVER-MIGRATION.md) | å®Œæ•´è¿ç§»æŒ‡å—ï¼ˆæœ€è¯¦ç»†ï¼‰|
| [SECURITY-CHECKLIST.md](SECURITY-CHECKLIST.md) | å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å• |
| [PORT-SECURITY.md](PORT-SECURITY.md) | ç«¯å£å®‰å…¨é…ç½® |
| [test-security.md](test-security.md) | å®‰å…¨æµ‹è¯•æŒ‡å— |

## ğŸ› ï¸ è„šæœ¬è¯´æ˜

| è„šæœ¬ | ç”¨é€” | ä½•æ—¶ä½¿ç”¨ |
|------|------|---------|
| `backup-before-reinstall.sh` | å¤‡ä»½æ‰€æœ‰æ•°æ® | é‡è£…å‰åœ¨æ—§æœåŠ¡å™¨è¿è¡Œ |
| `fresh-deploy.sh` | å…¨è‡ªåŠ¨éƒ¨ç½² | é‡è£…ååœ¨æ–°æœåŠ¡å™¨è¿è¡Œ |
| `deploy.sh` | å¸¸è§„æ›´æ–°éƒ¨ç½² | æ—¥å¸¸æ›´æ–°æ—¶ä½¿ç”¨ |
| `first-deploy.sh` | é¦–æ¬¡éƒ¨ç½² | å·²åºŸå¼ƒï¼Œä½¿ç”¨ fresh-deploy.sh |

## âš ï¸ é‡è¦æé†’

### å¤‡ä»½å‰æ£€æŸ¥

- [ ] æ•°æ®åº“å·²å¤‡ä»½ âœ…
- [ ] å¤‡ä»½å·²ä¸‹è½½åˆ°æœ¬åœ° âœ…
- [ ] éªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§ âœ…
- [ ] è®°å½•æ‰€æœ‰å¯†ç  âœ…
- [ ] DNSé…ç½®å·²è®°å½• âœ…

### é‡è£…å‰å‡†å¤‡

- [ ] é€‰æ‹©ä½å³°æ—¶æ®µï¼ˆå¦‚å‡Œæ™¨2-6ç‚¹ï¼‰
- [ ] é€šçŸ¥ç”¨æˆ·æœåŠ¡å°†æš‚æ—¶ä¸­æ–­
- [ ] å‡†å¤‡è‡³å°‘4å°æ—¶æ—¶é—´
- [ ] ç¡®ä¿æœ¬åœ°æœ‰å®Œæ•´å¤‡ä»½

### éƒ¨ç½²åéªŒè¯

- [ ] ç½‘ç«™å¯ä»¥è®¿é—®
- [ ] SSLè¯ä¹¦æœ‰æ•ˆ
- [ ] æ•°æ®åº“æ•°æ®å®Œæ•´
- [ ] PM2åº”ç”¨è¿è¡Œæ­£å¸¸
- [ ] é˜²ç«å¢™è§„åˆ™æ­£ç¡®

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¤‡ä»½è„šæœ¬è¿è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ‰‹åŠ¨å¤‡ä»½å…³é”®æ•°æ®ï¼š
```bash
# æ•°æ®åº“
pg_dump -U scales_user -d scales_db > backup.sql

# ç¯å¢ƒå˜é‡
cp .env.production ~/backup/

# æ‰“åŒ…
tar -czf backup.tar.gz ~/backup/
```

### Q: éƒ¨ç½²è„šæœ¬å¡ä½äº†ï¼Ÿ
A: æŒ‰ Ctrl+C åœæ­¢ï¼Œç„¶åæ‰‹åŠ¨æ‰§è¡Œï¼š
1. å‚è€ƒ SERVER-MIGRATION.md é€æ­¥æ“ä½œ
2. æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ

### Q: æ•°æ®åº“æ¢å¤å¤±è´¥ï¼Ÿ
A:
```bash
# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶
pg_restore -l backup.dump

# æ¸…ç©ºæ•°æ®åº“é‡æ–°æ¢å¤
sudo -u postgres psql -c "DROP DATABASE scales_db;"
sudo -u postgres psql -c "CREATE DATABASE scales_db OWNER scales_user;"
pg_restore -U scales_user -d scales_db -v backup.dump
```

### Q: SSLè¯ä¹¦æ— æ³•è·å–ï¼Ÿ
A:
1. ç¡®è®¤åŸŸåDNSå·²è§£æåˆ°æœåŠ¡å™¨IP
2. ç¡®è®¤80ç«¯å£å·²å¼€æ”¾
3. æ‰‹åŠ¨æ‰§è¡Œ: `sudo certbot --nginx -d your-domain.com`

### Q: ç½‘ç«™è®¿é—®502é”™è¯¯ï¼Ÿ
A:
```bash
# æ£€æŸ¥åº”ç”¨æ˜¯å¦è¿è¡Œ
pm2 status

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 logs knowyourself

# é‡å¯åº”ç”¨
pm2 restart knowyourself
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ•°æ®åº“ä¼˜åŒ–
```bash
# ç¼–è¾‘ PostgreSQL é…ç½®
sudo nano /etc/postgresql/*/main/postgresql.conf

# æ·»åŠ /ä¿®æ”¹ï¼ˆæ ¹æ®æœåŠ¡å™¨å†…å­˜è°ƒæ•´ï¼‰
shared_buffers = 512MB  # 25% of RAM
effective_cache_size = 1536MB  # 75% of RAM
```

### åº”ç”¨ä¼˜åŒ–
```bash
# ä½¿ç”¨ PM2 é›†ç¾¤æ¨¡å¼ï¼ˆå¤šæ ¸CPUï¼‰
pm2 start npm --name knowyourself -i max -- start

# è®¾ç½®è‡ªåŠ¨é‡å¯
pm2 set pm2:autodump true
pm2 save --force
```

---

## ğŸ“ ç´§æ€¥è”ç³»

- **äº‘æœåŠ¡å•†æ”¯æŒ**
  - é˜¿é‡Œäº‘: 95187
  - è…¾è®¯äº‘: 95716
  - AWS: +1-206-266-4064

- **å¤‡ç”¨æ–¹æ¡ˆ**
  - ä½¿ç”¨äº‘æœåŠ¡å•†å¿«ç…§æ¢å¤
  - è”ç³»æ•°æ®åº“ç®¡ç†å‘˜
  - å›æ»šåˆ°å¤‡ä»½æœåŠ¡å™¨

---

## âœ… éƒ¨ç½²æˆåŠŸæ ‡å¿—

å½“ä½ çœ‹åˆ°ä»¥ä¸‹å†…å®¹æ—¶ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼š

1. âœ… `pm2 status` æ˜¾ç¤ºåº”ç”¨è¿è¡Œä¸­
2. âœ… `curl https://your-domain.com` è¿”å›æ­£å¸¸
3. âœ… æµè§ˆå™¨è®¿é—®ç½‘ç«™æ­£å¸¸
4. âœ… SSLè¯ä¹¦æœ‰æ•ˆï¼ˆæµè§ˆå™¨æ˜¾ç¤ºé”å›¾æ ‡ï¼‰
5. âœ… æ•°æ®åº“æ•°æ®å®Œæ•´
6. âœ… é€Ÿç‡é™åˆ¶åŠŸèƒ½æ­£å¸¸ï¼ˆå‚è€ƒtest-security.mdæµ‹è¯•ï¼‰

---

**ç¥é‡è£…é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…è¯¦ç»†æ–‡æ¡£æˆ–å¯»æ±‚æŠ€æœ¯æ”¯æŒã€‚** ğŸ‰
